{% extends "travel/base.html" %}
{% load static %}
{% load bootstrap4 %}
{% load custom_filters %}
{% load verbose_names %}
{% load custom_tags %}
{% load i18n %}
{% block title_area %}{% endblock %}

{% block subcontent %}
  <div class="mb-5" id="app" v-cloak>

    <div v-if="loading" class="loading mb-3 mt-3 mt-5">
      <div class="spinner-border mb-3" style="width: 5rem; height: 5rem;" role="status">
        <span class="sr-only"></span>
      </div>
    </div>
    <div v-else class="row">
      <div class="col">
        <v-select
          v-model="user1"
          @input="getTravelUser('user1')"
          :options="users"
          label='full_name'
          :reduce="full_name => full_name.id"
          :clearable="true"
          placeholder="{% trans "Start typing to search for a user" %}"
        ></v-select>

        ${user1}

      </div>
      <div class="col">
        <v-select
          v-model="user2"
          @input="getTravelUser('user2')"
          :options="users"
          label='full_name'
          :reduce="full_name => full_name.id"
          :clearable="true"
          placeholder="{% trans "Start typing to search for a user" %}"
        ></v-select>
        ${user2}
      </div>
    </div>


  </div>
{% endblock %}


{% block body_js %}
  {{ block.super }}
  <script type="application/javascript">
  Vue.component('v-select', VueSelect.VueSelect);

  var app = new Vue({
    el: '#app',
    delimiters: ["${", "}"],
    data: {
      users: [],
      user1: null,
      user2: null,
      user1Object: {},
      user2Object: {},
      loading: false,
      loadingUser: false
    },
    methods: {
      getUsers() {
        this.loading = true;
        let endpoint = `/api/shared/viewsets/users/?is_active=true&page_size=50000`;
        apiService(endpoint).then(data => {
          this.users = data.results;
          this.loading = false;
        });
      },
      getTravelUser(target) {
        this.loadingUser = true;
        let endpoint = `/api/travel/users/${this[target]}/`;
        apiService(endpoint).then(data => {
          if (!data || !data.id) alert(groomJSON(data));
          else {
            this[target + "Object"] = data;
            this.loadingUser = false;
          }
        });
      },
    },
    created() {
      this.getUsers();
    }
  });

  </script>
{% endblock %}